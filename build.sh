#!/bin/bash

# è‡ªåŠ¨è®¾ç½® Maven é¡¹ç›®ç‰ˆæœ¬çš„è„šæœ¬
# ä½¿ç”¨æ–¹æ³•: ./build.sh [é¢å¤–å‚æ•°]
# ç¤ºä¾‹: ./build.sh -DskipTests

# åŸºç¡€ç‰ˆæœ¬å·
BASE_VERSION="1.0.0"

# ä½¿ç”¨æ—¥æœŸæ—¶é—´ä½œä¸ºç‰ˆæœ¬åç¼€
# æ ¼å¼: å¹´æœˆæ—¥.æ—¶åˆ†ç§’
VERSION="${BASE_VERSION}-$(date +%Y%m%d.%H%M%S)"

echo "========================================"
echo "  Bot Plugin Builder"
echo "========================================"
echo ""
echo "ç‰ˆæœ¬å·: ${VERSION}"
echo "ç¼–è¯‘æ—¶é—´: $(date '+%Y-%m-%d %H:%M:%S')"
echo ""

# æ‰§è¡Œ Maven æ„å»º
echo "å¼€å§‹æ„å»º..."
echo "========================================"
mvn clean package -Drevision="${VERSION}" "$@"

if [ $? -eq 0 ]; then
    echo ""
    echo "========================================"
    echo "âœ… æ„å»ºæˆåŠŸ!"
    echo "ç‰ˆæœ¬: ${VERSION}"
    echo "ç¼–è¯‘æ—¶é—´: $(date '+%Y-%m-%d %H:%M:%S')"
    echo "ğŸ“¦ JAR æ–‡ä»¶ä½ç½®: target/bot-${VERSION}.jar"
    echo "========================================"
else
    echo ""
    echo "========================================"
    echo "âŒ æ„å»ºå¤±è´¥!"
    echo "========================================"
    exit 1
fi
